import{w as l}from"./entry.mbXDUFAE.js";import{a as t,n as s}from"./index.aX4wazua.js";const c=l("chat",{state:()=>({chatList:{},userChat:{messages:[],name:"",description:""},messageLimit:null,messagesMakeRead:[],messageUpdate:{},messageReplied:{},messageText:"",searchElem:"",messageForwarded:{id:null},showForwardInfo:!1,checkboxForwarded:!0,showSendWindow:!1,messagePinned:{},arrayPin:[],activeChatNav:!0,windowWidth:0,showPinnedWindow:!1,showGroupCreate:!1,showGroupCreateChoice:!1,showVoiceInfo:!1,showChatInfo:!1,showSettingChat:!1,showChatChangeInfo:!1,showChatChangeInfoModal:!1,showChatCropper:!1,showImageChange:!1,chatChangeInfo:{name:"",img:"",description:""},showChangeWindowChat:!1,showChatGallery:!1,showDragInfo:!1,showUploadWindow:!1,updateChatName:"",updateDescription:"",voiceTimer:0,isGroup:!1,flag:!0,displayChat:"all",file:"",src:"",signature:"",fileSizeInfo:!1,fileReadInfo:!1,fileChecked:!1,fileUpload:null,results:{coordinates:null,image:null}}),getters:{get_chat_list:e=>e.chatList,get_user_chat:e=>e.userChat,get_pinned_list:e=>e.arrayPin},actions:{async loadChatList(e){await t.get(`api/v1/chat/chat-list?page=${e.page}&limit=${e.limit}`,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(a=>{this.chatList=a.data})},async loadUserChat(e){await t.get(`api/v1/chat/${e.id}?limit=${e.limit}&page=${e.page}`,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(a=>{if(this.messageLimit=a.data.messages.length,a.data.messages){this.userChat=a.data;let i=a.data.messages.reverse(),r=[...i];i=i.map(o=>new Date(o.created_at).toLocaleDateString()),i=[...new Set(i)];let h=i.map(o=>({messages:r.filter(n=>new Date(n.created_at).toLocaleDateString()==o),date:o}));this.userChat.messages=h}})},async loadPinnedList(e){await t.get(`api/v1/chat/message/pinned-list/${e.id}`,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(a=>{this.arrayPin=a.data})},async chatUpdate(e){let a=new FormData;this.updateChatName!==this.userChat.name&&a.set("name",e.update.name),this.updateDescription!==this.userChat.description&&a.set("description",e.update.description),this.fileUpload&&a.append("photo",e.update.photo,"image.webp"),await t.patch(`api/v1/chat/update/${e.id}`,a,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}})},async chatDelete(e){await t.delete(`api/v1/chat/delete/${e.id}`,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(a=>{})},async createMessage(e){let a=new FormData;!this.messageForwarded.id&&!this.file?a.set("text",e.text):!this.signature&&!this.messageForwarded.id?a.set("file",e.file):this.signature&&this.file?(a.set("text",e.text),a.set("file",e.file)):(a.set("text",e.text),a.set("message_id",e.message_id)),await t.post(`api/v1/chat/message/create/${e.id}`,a,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(i=>{this.messageForwarded={}})},async updateMessage(e){await t.patch(`api/v1/chat/message/update/${e.id}`,{text:e.text},{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(a=>{})},async deleteMessage(e){await t.delete(`api/v1/chat/message/delete/${e.id}`,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(a=>{})},async createChatUser(e){let a=new FormData;this.isGroup?(a.set("name",e.name),a.set("users",e.users),typeof e.photo!="string"&&a.set("photo",e.photo)):a.set("user_id",e.user_id),await t.post("api/v1/chat/create",a,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(i=>{this.loadChatList()})},async makeRead(e){await t.post("api/v1/chat/message/make-read",{messages:e.messages},{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(a=>{this.loadChatList()})},async makePinned(e){await t.post("api/v1/chat/message/make-pinned",{messages:e.messages},{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}})}}});export{c as u};
