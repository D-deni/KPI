{"version":3,"file":"auth-ltfjqTsG.js","sources":["../../../../stores/users.ts","../../../../stores/auth.ts"],"sourcesContent":["import axios from \"~/composables/axios\"\r\nimport {defineStore} from \"pinia\";\r\nimport {toast} from \"vue3-toastify\";\r\nimport {Router} from 'vue-router'\r\nimport nuxtStorage from \"nuxt-storage/nuxt-storage\";\r\nexport const useUserStore = defineStore('user-list', {\r\n  state: () => ({\r\n    user: {\r\n      id: '',\r\n      first_name: '',\r\n      last_name: '',\r\n      password: '',\r\n      email: '',\r\n      photo_file: '',\r\n      photo: '',\r\n      position_id: '',\r\n      position_name: '',\r\n      position: [{\r\n        id: '',\r\n        name: ''\r\n      }],\r\n      role_id: '',\r\n      role_name: '',\r\n      role_en: '',\r\n      role: {\r\n        id: '',\r\n        name: ''\r\n      },\r\n      phone: '',\r\n      department_id: '',\r\n      department: '',\r\n      company: '',\r\n      company_id: '',\r\n      salary: '',\r\n      date_of_birth: '',\r\n      permissions: [],\r\n    },\r\n    roleList: [],\r\n    userSearch: {},\r\n    permissions: [],\r\n    page: 1\r\n  }),\r\n  getters: {\r\n    get_user_list: (state) => state.user,\r\n    get_user_search: (state) => state.userSearch,\r\n    get_position_list: (state) => state.user.position,\r\n    get_role_list: (state) => state.roleList,\r\n    get_permission_list: (state) => state.permissions,\r\n  },\r\n  actions: {\r\n    async loadUserList(params: {\r\n      page: number,\r\n      limit: number,\r\n      query?: any,\r\n      user_type: any\r\n    }) {\r\n      await axios.get(`api/v1/user/${params.user_type}?query=${params.query}&page=${params.page}&limit=${params.limit}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.user = response.data\r\n      })\r\n    },\r\n    async loadUser(params: { id: any }) {\r\n      axios.get(`api/v1/user/${params.id}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.user = response.data\r\n      }).catch(e => {\r\n      })\r\n    },\r\n    async searchUser(params: { search: any }) {\r\n      axios.get(`api/v1/user/user-list/my-company?search=${params.search}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        this.userSearch = res.data\r\n      })\r\n    },\r\n\r\n    async createUser(params: { user: any }) {\r\n      let formD = new FormData();\r\n      formD.set('first_name', params.first_name)\r\n      formD.set('last_name', params.last_name)\r\n      formD.set('email', params.email)\r\n      formD.set('password', params.password)\r\n      formD.set('date_of_birth', params.date_of_birth.toISOString())\r\n      formD.set('photo_file', params.photo_file)\r\n      formD.set('phone', params.phone)\r\n      formD.set('position_id', params.position_id)\r\n      formD.set('role_id', params.role_id)\r\n      this.user.role_en === 'admin' ? formD.set('company_id', params.company_id) : formD.set('department_id', params.department_id)\r\n      if (typeof params.photo_file !== 'string') {\r\n        formD.set('photo_file', params.photo_file)\r\n      }\r\n      axios.post(`api/v1/user/create`, formD, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.user = response.data\r\n        this.loadUserList({user_type: 'user-list/my-company', limit: 5, page: 1, query: ''})\r\n      }).catch(e => {\r\n      })\r\n    },\r\n    async deleteUser(params: { user_id: number }, router: Router) {\r\n      axios.delete(`api/v1/user/delete/${params.user_id}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.user = response.data\r\n        router.push('/base/users')\r\n        toast.success('Пользователь успешно удалён', {autoClose: 1500, theme: 'auto'})\r\n      }).catch(e => {\r\n        toast.error(e, {autoClose: 1500, theme: 'auto'})\r\n      })\r\n    },\r\n\r\n    async loadPositionList() {\r\n      axios.get(`api/v1/position/position-list`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.user.position = response.data\r\n      })\r\n    },\r\n    async loadRoleList() {\r\n      axios.get(`api/v1/role/role-list`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.roleList = response.data\r\n      })\r\n    },\r\n    async loadPermissions() {\r\n      axios.get(`api/v1/permission/permission-list`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.permissions = response.data\r\n      })\r\n    }\r\n  }\r\n})","import {defineStore} from \"pinia\";\r\nimport axios from \"~/composables/axios\";\r\nimport {toast} from \"vue3-toastify\";\r\nimport {useUserStore} from \"~/stores/users\";\r\nimport type {Router} from \"vue-router\";\r\nimport nuxtStorage from \"nuxt-storage/nuxt-storage\";\r\nimport {useI18n} from \"vue-i18n\";\r\n\r\nexport const useAuthStore = defineStore('authUser', {\r\n  state: () => ({\r\n    current_user: {\r\n      id: null,\r\n      email: '',\r\n      password: '',\r\n      date_of_birth: '',\r\n      first_name: '',\r\n      last_name: '',\r\n      company_id: '',\r\n      phone: '',\r\n      photo: '',\r\n      position: '',\r\n      role: '',\r\n      role_en: '',\r\n      status: '',\r\n      passport: '',\r\n      salary: {},\r\n      permissions: []\r\n    },\r\n    user: {},\r\n    permissions: [],\r\n    exam_active: false,\r\n    openNotification: false,\r\n    openSettings: false,\r\n    my_scroll: 0,\r\n  }),\r\n  getters: {\r\n    get_current_user(current_user) {\r\n      return this.current_user\r\n    },\r\n    get_user(user){\r\n      return this.user\r\n    },\r\n    get_server_domain(){\r\n      return 'https://api-buildwithus.ai-softdev.com'\r\n    }\r\n  },\r\n  actions: {\r\n    async authorize(params: { email: any, password: any }, router: Router) {\r\n      await axios.post('api/v1/auth/login', {\r\n        email: params.email,\r\n        password: params.password,\r\n      }, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        nuxtStorage.localStorage.setData('token', response.data.access)\r\n        this.loadCurrentUser()\r\n        router.push('/base/companies').then(e=>{\r\n          toast.success('Успешная авторизация', {autoClose: 1500, theme: 'auto'},)\r\n        })\r\n      }).catch(e => {\r\n        router.push('/')\r\n        toast.error('Неверный логин или пароль', {autoClose: 1500, theme: \"auto\"})\r\n      })\r\n    },\r\n    async loadCurrentUser() {\r\n     await axios.get('api/v1/user/current-user', {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.user = response.data\r\n      })\r\n    },\r\n    async update_user(params: { user: any, update_type: any, permissions_ids?: any }) {\r\n      let fd = new FormData();\r\n      fd.set('first_name', params.user.first_name)\r\n      fd.set('last_name', params.user.last_name)\r\n      fd.set('phone', params.user.phone)\r\n      fd.set('password', params.user.password)\r\n      fd.set('salary', params.user.salary)\r\n      fd.set('position', params.user.position)\r\n      fd.set('email', params.user.email)\r\n      fd.set('date_of_birth', params.user.date_of_birth)\r\n      fd.set('passport', params.user.passport)\r\n      if (params.update_type !== 'update-my') {\r\n        fd.set('permissions_ids', params.permissions_ids)\r\n        fd.set('role_id', params.user.role_id)\r\n      }\r\n      if (typeof params.user.photo === 'string') {\r\n        fd.set('photo', params.user.photo)\r\n      }\r\n      await axios.patch(`api/v1/user/${params.update_type}`, fd, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        if(params.update_type !== `update-my`) {\r\n          this.current_user = response.data\r\n          const user = useUserStore()\r\n          user.loadUser({id: params.user.id})\r\n        } else {\r\n          this.loadCurrentUser()\r\n          this.user = response.data\r\n        }\r\n        toast.success('Данные успешно обновлены', {autoClose: 1500, theme: 'auto'})\r\n      }).catch(e => {\r\n        toast.error(e, {autoClose: 1500, theme: 'auto'})\r\n      })\r\n    }\r\n  },\r\n})"],"names":[],"mappings":"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"}