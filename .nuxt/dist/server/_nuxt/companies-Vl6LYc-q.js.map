{"version":3,"file":"companies-Vl6LYc-q.js","sources":["../../../../stores/companies.ts"],"sourcesContent":["import {defineStore} from \"pinia\";\r\nimport axios from \"~/composables/axios\";\r\nimport {toast} from \"vue3-toastify\";\r\nimport {Router} from \"vue-router\";\r\nimport nuxtStorage from \"nuxt-storage/nuxt-storage\";\r\n\r\nexport const useCompanies = defineStore('current-company', {\r\n  state: () => ({\r\n    company: {\r\n      id: '',\r\n      name: '',\r\n      address: '',\r\n      created_at: '',\r\n      description: '',\r\n      email: '',\r\n      logo_file: '',\r\n      users_count: '',\r\n      departments_count: '',\r\n      objects_count: ''\r\n    },\r\n    news: {\r\n      title: '',\r\n      description: '',\r\n      photo: '',\r\n      photo_url: ''\r\n    },\r\n    department: {\r\n      id: '',\r\n      name: '',\r\n      participants: []\r\n    },\r\n    current_department: {\r\n      id: '',\r\n      name: '',\r\n      participants: []\r\n    }\r\n  }),\r\n  getters: {\r\n    current_company(company) {\r\n      return this.company\r\n    },\r\n    get_all_company(company) {\r\n      return this.company\r\n    },\r\n    get_all_news(news) {\r\n      return this.news\r\n    },\r\n    get_all_department(department) {\r\n      return this.department\r\n    },\r\n    get_department(current_department){\r\n      return this.current_department\r\n    }\r\n  },\r\n  actions: {\r\n    async loadCurrentCompany() {\r\n      await axios.get('api/v1/company/my-company', {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.company = response.data\r\n      })\r\n    },\r\n    async loadCompanyList(params: { page: number, limit: number, query: string }) {\r\n      await axios.get(`api/v1/company/company-list?page=${params.page}&limit=${params.limit}&query=${params.query}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.company = response.data\r\n      })\r\n    },\r\n    async loadCompany(params: { id: number }) {\r\n      await axios.get(`api/v1/company/${params.id}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.company = response.data\r\n      })\r\n    },\r\n    async loadDepartmentList() {\r\n      await axios.get('api/v1/department/department-list', {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.department = response.data\r\n      })\r\n    },\r\n    async loadDepartment(params: { id: number }) {\r\n      await axios.get(`api/v1/department/${params.id}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.current_department = response.data\r\n      })\r\n    },\r\n\r\n    async loadNewsList() {\r\n      await axios.get(`api/v1/news/news-list`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.news = response.data\r\n      })\r\n    },\r\n    async loadNews(params: { id: number }) {\r\n      await axios.get(`api/v1/news/${params.id}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.news = response.data\r\n      })\r\n    },\r\n\r\n    async createCompany(params: { company: any }): Promise<void> {\r\n      let fd = new FormData();\r\n      fd.set('name', params.company.name)\r\n      fd.set('address', params.company.address)\r\n      fd.set('description', params.company.description)\r\n      fd.set('email', params.company.email)\r\n      if (typeof params.company.logo_file !== 'string') {\r\n        fd.set('logo_file', params.company.logo_file)\r\n      }\r\n      await axios.post(`api/v1/company/create`, fd, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.company = response.data\r\n        toast.success('Компания успешно создана', {autoClose: 1500, theme: 'auto'})\r\n        this.loadCompanyList({page: 1, limit: 5, query: ''})\r\n      }).catch(e => {\r\n        toast.error(e, {autoClose: 1500, theme: 'auto'})\r\n      })\r\n    },\r\n\r\n    async createDepartment(params: { department: any }) {\r\n      await axios.post(`api/v1/department/create`, {\r\n        name: params.department.name,\r\n      }, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        this.department = res.data\r\n        this.loadDepartmentList()\r\n      }).catch(e => {\r\n        toast.error('Ошибка при создании', {theme: 'auto', autoClose: 1500})\r\n      })\r\n    },\r\n    async deleteDepartment(params: {id: any}, router: Router) {\r\n      await axios.delete(`api/v1/department/delete/${params.id}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        toast.success('Успешно удалён', {autoClose: 1500, theme: 'auto'})\r\n        this.department = res.data\r\n        router.go(-1)\r\n      })\r\n    }\r\n  }\r\n})"],"names":[],"mappings":"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"}